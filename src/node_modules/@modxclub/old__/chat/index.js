import React, { Component } from 'react';

import Avatar from '../Avatar';
import List, {ListSubheader, ListItem } from 'material-ui/List';

 

const propTypes = {
  users: React.PropTypes.array,
}

const defaultProps = {
  users: []
}

class Chat extends Component {


  constructor(props){

    super(props);

    this.state = {
      user: props.user,
      users: props.user.users,
      users_hash: props.user.users_hash,
    };
  }

  componentWillReceiveProps(nextProps){


    if(nextProps.user.users_hash != this.props.user.users_hash){

      this.setState({
        users: nextProps.user.users,
        users_hash: nextProps.user.users_hash,
      });
    }

    return true;
  }


  shouldComponentUpdate(nextProps, nextState){


    if(nextState.users_hash != this.state.users_hash){

      return true;
    }

    return false;
  }

  onClick(username){
    this.props.documentActions.LoadDocument("profile/" + username);
  }

  render(){


    // alert("sdfsdf");


    var users = [];

    for(var i in this.state.users){
      var user = this.state.users[i];

      users.push(<ListItem
        key={i}
        primaryText={user.username}
        onClick={this.onClick.bind(this, user.username)}
        leftAvatar={user.photo
          ?
          (<Avatar
            src={user.photo} />)
          :
          (<Avatar >
            {user && user.username ? user.username.substr(0,1).toUpperCase() : ""}
          </Avatar>)
        }
        secondaryText={<span>{user.fullname}</span>}
      />);
    }

    // rightIcon={<CommunicationChatBubble />}

    return (
        <div style={{
          height: '100%',
          maxHeight: '100%',
          overflow: 'auto'
        }}>
          <List>
            <ListSubheader>{this.state.users ? "Активные пользователи" : "Никого нет онлайн"}</ListSubheader>

            {users}
          </List>
        </div>
    );
  }
}


Chat.propTypes = propTypes;
Chat.defaultProps = defaultProps;
 

 


export default Chat


